<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: java | Luc Dewavrin&#39;s weblog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <link rel="alternative" href="/atom.xml" title="Luc Dewavrin&#39;s weblog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1239956-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luc Dewavrin&#39;s weblog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-github-link" class="nav-icon" href="https://github.com/lucdew" target="_blank"></a>
        <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/lucdew" target="_blank"></a>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://www.dewavrin.info"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-spring-entitymanagerfactory-jta-and-non-jta-modes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/spring-entitymanagerfactory-jta-and-non-jta-modes/" class="article-date">
  <time datetime="2008-06-22T22:00:00.000Z" itemprop="datePublished">Jun 23 2008</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/general/">general</a>►<a class="article-category-link" href="/categories/java/general/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/spring-entitymanagerfactory-jta-and-non-jta-modes/">Spring entityManagerFactory in jta and non-jta modes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This blog post is about using JPA with Spring in 2 contexts :</p>
<ul>
<li>production with a JTA transaction manager</li>
<li>testing with transactions handled by jpa transaction manager.<br>It has been inspired by <a href="http://erich.soomsam.net/2007/04/24/spring-jpa-and-jta-with-hibernate-and-jotm/" target="_blank" rel="external">Erich Soomsam blog post</a>You can achieve such configuration with a PersistenceUnitPostProcessor having a single persistence.xml file and 2 Spring context files (1 for each environment).Since you are likely to have at least 2 different Spring dataSource definitions : 1 for production that performs a JNDI lookup to find a bound datasource and 1 for development that uses a local and Spring declared datasource backed by a JDBC connection pool (C3p0 or DBCP), place the entityManager declaration in the same file as the datasource declaration. Let’s say that the default persistence.xml use the non-jta datasource:<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">persistence</span> <span class="attribute">xmlns</span>=<span class="value">"http://java.sun.com/xml/ns/persistence"</span></span></div><div class="line">	<span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attribute">xsi:schemalocation</span>=<span class="value">"http://java.sun.com/xml/ns/persistence    http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"</span></div><div class="line">	<span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="title">persistence-unit</span> <span class="attribute">transaction-type</span>=<span class="value">"RESOURCE_LOCAL"</span></span></div><div class="line">		<span class="attribute">name</span>=<span class="value">"seamphony"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="title">properties</span>&gt;</span>     <span class="comment">&lt;!-- Scan for annotated classes and Hibernate mapping XML files --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"class, hbm"</span> <span class="attribute">name</span>=<span class="value">"hibernate.archive.autodetection"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"hibernate.dialect"</span> <span class="attribute">value</span>=<span class="value">"org.hibernate.dialect.MySQLDialect"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">properties</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">persistence-unit</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">persistence</span>&gt;</span></div></pre></figure><br>Here’s how you can use Spring to post process the persistence unit and configure it for production (here with MySQL datasource and JBoss Transaction Manager):<br><figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span></span></div><div class="line">	class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</div><div class="line">	id="entityManagerFactory"&gt;</div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">ref</span>=<span class="value">"dataSource"</span> <span class="attribute">name</span>=<span class="value">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jpaVendorAdapter"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"MYSQL"</span> <span class="attribute">name</span>=<span class="value">"database"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"showSql"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"org.hibernate.dialect.MySQLDialect"</span> <span class="attribute">name</span>=<span class="value">"databasePlatform"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jpaPropertyMap"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">map</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"org.hibernate.transaction.JBossTransactionManagerLookup"</span></span></div><div class="line">		<span class="attribute">key</span>=<span class="value">"hibernate.transaction.manager_lookup_class"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">key</span>=<span class="value">"hibernate.transaction.flush_before_completion"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">key</span>=<span class="value">"hibernate.transaction.auto_close_session"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"jta"</span> <span class="attribute">key</span>=<span class="value">"hibernate.current_session_context_class"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"auto"</span> <span class="attribute">key</span>=<span class="value">"hibernate.connection.release_mode"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">entry</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">map</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"persistenceUnitPostProcessors"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"JtaPersistenceUnitPostProcessor"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"jtaMode"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">ref</span>=<span class="value">"dataSource"</span> <span class="attribute">name</span>=<span class="value">"jtaDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">list</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span><span class="comment">&lt;!-- Datasource Lookup --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.jndi.JndiObjectFactoryBean"</span> <span class="attribute">id</span>=<span class="value">"dataSource"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"resourceRef"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">value</span>&gt;</span>false<span class="tag">&lt;/<span class="title">value</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jndiName"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">value</span>&gt;</span>java:/MyDS<span class="tag">&lt;/<span class="title">value</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span><span class="comment">&lt;!-- Transaction Manager --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.transaction.jta.JtaTransactionManager"</span></span></div><div class="line">	<span class="attribute">id</span>=<span class="value">"transactionManager"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"java:/TransactionManager"</span> <span class="attribute">name</span>=<span class="value">"transactionManagerName"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"false"</span> <span class="attribute">name</span>=<span class="value">"autodetectUserTransaction"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

</li>
</ul>
<p>Here’s the class that reads the jta mode property and configure the transaction type accordingly:</p>
<figure class="highlight java"><pre><div class="line"><span class="keyword">import</span> javax.persistence.spi.PersistenceUnitTransactionType;</div><div class="line"><span class="keyword">import</span> javax.sql.DataSource;</div><div class="line"><span class="keyword">import</span> org.springframework.orm.jpa.persistenceunit.MutablePersistenceUnitInfo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.orm.jpa.persistenceunit.PersistenceUnitPostProcessor;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JtaPersistenceUnitPostProcessor</span> <span class="keyword">implements</span></span></div><div class="line">		<span class="title">PersistenceUnitPostProcessor</span> {</div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> jtaMode = <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">private</span> DataSource jtaDataSource;</div><div class="line">	<span class="keyword">private</span> PersistenceUnitTransactionType transacType = PersistenceUnitTransactionType.RESOURCE_LOCAL;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessPersistenceUnitInfo</span>(</div><div class="line">			MutablePersistenceUnitInfo mutablePersistenceUnitInfo) {</div><div class="line">		<span class="keyword">if</span> (jtaMode) {</div><div class="line">			transacType = PersistenceUnitTransactionType.JTA;</div><div class="line">			mutablePersistenceUnitInfo</div><div class="line">					.setJtaDataSource(<span class="keyword">this</span>.getJtaDataSource());</div><div class="line">		}</div><div class="line">		mutablePersistenceUnitInfo.setTransactionType(transacType);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isJtaMode</span>() {</div><div class="line">		<span class="keyword">return</span> jtaMode;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJtaMode</span>(<span class="keyword">boolean</span> jtaMode) {</div><div class="line">		<span class="keyword">this</span>.jtaMode = jtaMode;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> DataSource <span class="title">getJtaDataSource</span>() {</div><div class="line">		<span class="keyword">return</span> jtaDataSource;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJtaDataSource</span>(DataSource jtaDataSource) {</div><div class="line">		<span class="keyword">this</span>.jtaDataSource = jtaDataSource;</div><div class="line">	}</div><div class="line">}</div></pre></figure>

<p>Spring really helps tuning your persistence unit for different environments. It could be achieved by a custom build task that could alter the persistence.xml file but since this example assumes that Spring is already used, it can be avoided.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/spring-entitymanagerfactory-jta-and-non-jta-modes/" data-id="dl3ktycejtqnt5e6" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/spring-entitymanagerfactory-jta-and-non-jta-modes/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jpa/">jpa</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-stat-your-commits" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/stat-your-commits/" class="article-date">
  <time datetime="2008-06-01T22:00:00.000Z" itemprop="datePublished">Jun 2 2008</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/stat-your-commits/">Stat your commits</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I recently discover the <a href="http://stat-scm.sourceforge.net/" target="_blank" rel="external">StatSCM</a> maven plugin and it made our team day . It gives useful information about your Subversion activity (it supports other SCM systems) giving precise developers activity information or file statistics. It also generates some nice charts. I found it very useful to monitor what the team members commit: for instance we discovered that a trainee was the developer of the month (ranked by LOC commited) because he commited some very large csv test files.First to enable it, configure the dependency and declare the report in the reports section of your maven parent pom file:</p>
<p><figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">pom</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">build</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">plugins</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="title">groupid</span>&gt;</span>net.sf<span class="tag">&lt;/<span class="title">groupid</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="title">artifactid</span>&gt;</span>stat-scm<span class="tag">&lt;/<span class="title">artifactid</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">groupid</span>&gt;</span>net.sf<span class="tag">&lt;/<span class="title">groupid</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">artifactid</span>&gt;</span>stat-svn<span class="tag">&lt;/<span class="title">artifactid</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">version</span>&gt;</span>0.4.0-StatSCM<span class="tag">&lt;/<span class="title">version</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">groupid</span>&gt;</span>org.apache.maven.reporting<span class="tag">&lt;/<span class="title">groupid</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">artifactid</span>&gt;</span>maven-reporting-impl<span class="tag">&lt;/<span class="title">artifactid</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">version</span>&gt;</span>2.0.4<span class="tag">&lt;/<span class="title">version</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">build</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">reporting</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">plugins</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="title">groupid</span>&gt;</span>net.sf<span class="tag">&lt;/<span class="title">groupid</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="title">artifactid</span>&gt;</span>stat-scm<span class="tag">&lt;/<span class="title">artifactid</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="title">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="title">excludes</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="title">exclude</span>&gt;</span>**/*.csv<span class="tag">&lt;/<span class="title">exclude</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="title">excludes</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">reporting</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">pom</span>&gt;</span>	</div></pre></figure><br>And here some charts produced, like the number of LOC commited by each developer:<a href="http://www.dewavrin.info/images/custom/loc.png" target="_blank" rel="external"><img src="http://www.dewavrin.info/images/custom/loc.png" alt="Number of lines of code" title="Number of lines of code"></a>The  day commit activity:<a href="http://www.dewavrin.info/images/custom/commitsactivity.png" target="_blank" rel="external"><img src="http://www.dewavrin.info/images/custom/commitsactivity.png" alt="Commits activity" title="Commits activity"></a>Or the ration between files addition/modification:<a href="http://www.dewavrin.info/images/custom/activity.png" target="_blank" rel="external"><img src="http://www.dewavrin.info/images/custom/activity.png" alt=""></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/stat-your-commits/" data-id="y94dnmh46mt8jhme" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/stat-your-commits/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/">maven</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/subversion/">subversion</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opensource-java-bpm-compared" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/opensource-java-bpm-compared/" class="article-date">
  <time datetime="2008-01-16T23:00:00.000Z" itemprop="datePublished">Jan 17 2008</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/opensource-java-bpm-compared/">Opensource Java BPM compared</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>(Seen on jBPM mailing-list): a quite interesting study between the non-exhaustive Java BPM engines (jBPM, enhydra shark, openwfe) has been published. Follow this <a href="http://www.workflowpatterns.com/documentation/documents/BPM-07-12.pdf" target="_blank" rel="external">link</a>.Updated 2008/08 : The report has been updated (see <a href="http://www.infoq.com/news/2008/08/oswf" target="_blank" rel="external">http://www.infoq.com/news/2008/08/oswf</a>)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/opensource-java-bpm-compared/" data-id="zlm62s0moowsqv18" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/opensource-java-bpm-compared/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jBPM/">jBPM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-htmlunit-kudos" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/htmlunit-kudos/" class="article-date">
  <time datetime="2007-12-25T23:00:00.000Z" itemprop="datePublished">Dec 26 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/htmlunit-kudos/">htmlunit kudos</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have been happily surprised by htmlunit. Actually, for a personal project, rewriting a rails app to Seam I tried to find a replacement of excellent Ruby library <a href="http://code.whytheluckystiff.net/hpricot/" title="Hpricot" target="_blank" rel="external">hpricot</a>. I needed to perform Xpath expression on a HTML DOM tree to retrieve nodes.Well, htmlunit combined with Neko html parser and jaxen Xpath excels at just doing that. Htmlunit is also used by Canoo web testing .Here’s a code snippet to retrieve all USA states on Yahoo Weather :</p>
<figure class="highlight java"><pre><div class="line"><span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</div><div class="line"><span class="keyword">final</span> HtmlPage page = (HtmlPage) webClient.getPage(<span class="string">"http://weather.yahoo.com/regional/USXX.html"</span>);</div><div class="line">HtmlUnitXPath xpath = <span class="keyword">new</span> HtmlUnitXPath(<span class="string">"//div[@class='clearfix' and @id='browse']/ul/li/a"</span>);</div><div class="line">List nodes = (List)xpath.selectNodes(page);</div><div class="line"><span class="keyword">for</span> (HtmlAnchor anchor: nodes) {       </div><div class="line">   System.out.println(anchor.asText());</div><div class="line">}</div></pre></figure>

<p>Ok maybe htmlunit could reduce its dependencies and use Xpath support added to Java 5 (via Jaxp 1.3). But that’s what i like about Java plateform: there’s virtually a library for every need. And with (more or less) recent additions to the language: Generics, autoboxing, enums, DSL like code constructions (Fluent Interfaces) and future additions like closures, there are less and less reasons to use dynamically typed languages (even if i like Groovy).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/htmlunit-kudos/" data-id="2igj3d4ti64d8fsq" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/htmlunit-kudos/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/htmlunit/">htmlunit</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xpath/">xpath</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-jbpm-review" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/a-jbpm-review/" class="article-date">
  <time datetime="2007-11-15T23:00:00.000Z" itemprop="datePublished">Nov 16 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/a-jbpm-review/">A jBPM review</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Here’s a quick review of <a href="http://labs.jboss.com/jbossjbpm/" target="_blank" rel="external">jBPM</a> and some issues I experimented on a recent project.<strong>jBPM features:</strong></p>
<ul>
<li><strong>A bare workflow engine</strong> focused on persistence of a business process.</li>
<li><strong>Graph oriented programming</strong> with different kinds of nodes (wait,action,decision, tasks,etc.) . The graph is represented in XML format following the Jboss Process Definition Language format.</li>
<li><strong>Persistence handled by Hibernate</strong>.</li>
<li><strong>An eclipse plugin to visually design the Business Process</strong> and generate the jPDLsource file. It can also generate a web form to enable user interactions with the Business Process (task nodes).</li>
<li><strong>BPEL support</strong> and <strong>integration with Jboss ESB</strong>.</li>
<li><strong>A web console with JSF components</strong> that allows to find process instances, timers, execute tasks and deploy jBPDL processes.<br>The main drawbacks with jBPM are:</li>
<li><strong>jBPM does not provide any connectors</strong> for wait nodes (incoming events) or action nodes (interaction with external systems). You have to code them and use jBPM API for signalling a process instance that it should proceed execution. Also by default, a signal operation on a process instance is synchronous and blocks until it finds a  wait node or any node with async attribute set to true .</li>
<li><strong>the Business Process can not be published as a web service</strong>. You can pass  data to the buisness process storing variable in its execution context with the jBPM API.</li>
<li><strong>No “business transaction” support</strong>.</li>
<li><strong>Documentation is not really up-to-date</strong> and be prepared to spend time on the wiki and the forums For instance we experienced the following issues:<ul>
<li>We didn’t use the jBPM console and we spent some time trying to figure out how to start jBPM timers. Well, a JobScheduler had to be started behind the scene .</li>
<li>We had troubles with transaction management and integration with JTA transactions. This one was not jBPM’s fault but we spent some time on it. jBPM JobScheduleService delete persisted timers when the business process ends. It does this before the commit of the transaction by registering a JTA’s Synchronization instance on the current JTA Transaction.  Our jBPM Hibernate session was also handled by Spring and also registered a Synchronization instance that closed the Hibernate session before commit. Of course, it closed session before the JobScheduler  and made the JobScheduler  fail to delete timers. As a workaround, we had to use raw Hibernate SessionFactory to prevent this (it avoided Spring ‘s beforeCommit session closing):<br><figure class="highlight"><pre><div class="line">hibernate.<span class="keyword">transaction</span>.factory_class=org.hibernate.<span class="keyword">transaction</span>.JTATransactionFactory</div><div class="line">hibernate.<span class="keyword">transaction</span>.manager_lookup_class=org.hibernate.<span class="keyword">transaction</span>.JBossTransactionManagerLookup</div><div class="line">hibernate.current_session_context_class=org.hibernate.context.JTASessionContext</div></pre></figure><br>and setting the following property of the LocalSessionFactoryBean:<br><figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"false"</span> <span class="attribute">name</span>=<span class="value">"exposeTransactionAwareSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div></pre></figure><br>Also, we used the <a href="https://springmodules.dev.java.net/" target="_blank" rel="external">Spring jBPM module</a> since our jBPM actions, decision handlers were implemented as Spring beans. Spring module offers workflow deployments features but we found little value in Spring modules  since it’s quite easy to extend jBPM to look for Spring beans in a Spring context. The jBPM Spring module does not seem to be maintained anymore.So, jBPM is really a bare workflow engine and we hope it will offer tigher integration with Jboss ESB for connection with external systems and also more advanced features.Seam offers integration with jBPM : you can register a jBPM process definition as a Seam component, and let Seam deploy it.  Seam also provides some anotations to interact with a business process to share data (bijection) with it or start it in a Seam conversation. Seam’s adoption will probably boost jBPM’s usage, well at least i am looking forward to it.</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/a-jbpm-review/" data-id="y6a0lh4fkeh5jykz" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/a-jbpm-review/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jBPM/">jBPM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-seam-20-released" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/seam-20-released/" class="article-date">
  <time datetime="2007-11-04T23:00:00.000Z" itemprop="datePublished">Nov 5 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/seam-20-released/">Seam 2.0 released</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>That’s it <a href="http://in.relation.to/Bloggers/WhatsNewInSeam2" target="_blank" rel="external">Seam 2.o has just been released</a>.I am still not sure about Redhat commitment in Jboss products but i hope Seam 2.0 will be a big success since it leverages JavaEE 5 standards (ejb3, Jsf) and Jboss projects (jBPM, drools).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/seam-20-released/" data-id="fwztsgqwln87omht" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/seam-20-released/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/seam/">seam</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-create-your-own-logger-annotation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/create-your-own-logger-annotation/" class="article-date">
  <time datetime="2007-08-26T22:00:00.000Z" itemprop="datePublished">Aug 27 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/create-your-own-logger-annotation/">Create your own @Logger annotation</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Some frameworks like Seam use the <span class="term"><tt class="literal">@Logger </tt></span>annotation to instantiate a logger. Seam discovers at deployment annotated classes  (see the <a href="http://viewvc.jboss.org/cgi-bin/viewvc.cgi/jboss/jboss-seam/src/main/org/jboss/seam/deployment/Scanner.java?revision=1.29&amp;view=markup" target="_blank" rel="external">Scanner</a> class for instance).You could mimic this behaviour with Spring and its AOP capabilities on Spring beans with the &lt;aop:aspectj-autoproxy/&gt; feature.But if you don’t want to bootstrap your application with an IOC  container or a framework, there’s still AspectJ AOP to the rescue.For the example, let’s create the Logger marker annotation (AspectJ requires the target retention to be set to RUNTIME).</p>
<figure class="highlight java"><pre><div class="line"><span class="annotation">@Target</span>({FIELD})</div><div class="line"><span class="annotation">@Retention</span>(RUNTIME)</div><div class="line"><span class="annotation">@Documented</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> @<span class="class"><span class="keyword">interface</span> <span class="title">Logger</span> </span>{}</div></pre></figure>

<p>Now in any class of your application, create a Logger (to make it short we’ll use the commons-logging API and its org.apache.commons.logging.Log interface).Example:</p>
<figure class="highlight java"><pre><div class="line"><span class="annotation">@Logger</span> <span class="keyword">private</span> org.apache.commons.logging.Log logger;</div></pre></figure>

<p>Then the aspect with Aspectj annotated feature and a bunch of reflection to instantiate the logger appropriately (it only invokes the LogFactory and sets the proper class name).</p>
<figure class="highlight java"><pre><div class="line"><span class="annotation">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggerAspect</span> </span>{</div><div class="line"> </div><div class="line">  <span class="annotation">@Before</span>(<span class="string">"get(@Logger Log biz.dewavrin..*)"</span>)</div><div class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span>(JoinPoint thisJoinPoint) {</div><div class="line">    System.out.println(<span class="string">"ASPECT logger applied"</span>);</div><div class="line"> </div><div class="line">    Field[] fields = thisJoinPoint.getTarget().getClass().getFields();</div><div class="line">    Class clazz = thisJoinPoint.getSignature().getDeclaringType();</div><div class="line"> </div><div class="line">    <span class="keyword">try</span> {</div><div class="line">      Field field = clazz.getDeclaredField(thisJoinPoint.getSignature().getName());</div><div class="line">      field.setAccessible(<span class="keyword">true</span>);</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">null</span> == field.get(thisJoinPoint.getTarget()) ) {</div><div class="line">          field.set(thisJoinPoint.getTarget(), <span class="keyword">new</span> KeyLogger(thisJoinPoint.getSignature().getDeclaringTypeName()));</div><div class="line">      }</div><div class="line"> </div><div class="line">    } <span class="keyword">catch</span> (Throwable t) {</div><div class="line">        System.err.println(<span class="string">"Warning aspect no applied on class="</span>+thisJoinPoint.getTarget().getClass().getCanonicalName());</div><div class="line">    }</div><div class="line">  }</div><div class="line"> </div><div class="line">}</div></pre></figure>

<p>The key here is the pointcut definition with a @Before advice and the get pointcut which intercepts accesses to every field annotated with @Logger annotations from a base package and its descendents.To build with maven, bind the maven’s aspectj plugin compile goal to your compile phase:</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>aspectj-maven-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">source</span>&gt;</span>1.5<span class="tag">&lt;/<span class="title">source</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">target</span>&gt;</span>1.5<span class="tag">&lt;/<span class="title">target</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">executions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">execution</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="title">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="title">phase</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">goals</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">execution</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">executions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></div></pre></figure>

<p>Note that the aspect could be packaged in a dedicated library and woven to your classes (see <a href="http://mojo.codehaus.org/aspectj-maven-plugin/libraryJars.html" target="_blank" rel="external">aspects libraries</a>) for usage example.</p>
<p>=&gt; Ok this example is only for demonstrative purpose and adds the overhead of reflection on every access to common’s logging Log implementation getters !So it might not be a good idea after all due to performance penalty. But it’s just a starting point for other annotations with aspects ideas to build your own framework.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/create-your-own-logger-annotation/" data-id="sypcdq0ky9vqufb1" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/create-your-own-logger-annotation/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspectj/">aspectj</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-impressive-jboss-tools-on-eclipse-europa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/impressive-jboss-tools-on-eclipse-europa/" class="article-date">
  <time datetime="2007-07-23T22:00:00.000Z" itemprop="datePublished">Jul 24 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/impressive-jboss-tools-on-eclipse-europa/">Impressive Jboss tools on Eclipse Europa</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I gave RedHat Developer Studio (a.k.a Jboss tools)  a quick try and it seems quite promising. I set it up on a brand new Eclipse Europa using <a href="http://download.jboss.org/jbosstools/builds/nightly/" title="Jboss nightly builds" target="_blank" rel="external">the nightly builds</a>It integrates Exadel Studio for Jsf development, and plugins to develop with your favorite Jboss Enterprise Middleware System  tools and frameworks (hibernate, jbpm , jboss rules, jboss tree and aop cache,Jboss WS (jsr-181)) and off course the brand new Seam. It will offer a complete enterprise grade and open source middleware stack with a nice ide.I am really looking forward to the final release.<br>Here are some screenshots:</p>
<ul>
<li>Hibernate’s perspective (using a Jpa persistance unit):</li>
</ul>
<p><a href="http://www.dewavrin.info/images/custom/rhds-hibernate.JPG" target="_blank" rel="external"><img src="http://www.dewavrin.info/images/custom/rhds-hibernate.JPG" alt="Hibernate perspective (Jpa persistance unit)" title="Hibernate perspective (Jpa persistance unit)"></a></p>
<ul>
<li>Facelet design/source view<br><a href="http://www.dewavrin.info/images/custom/jsf_facelets_visual.JPG" title="Exadel" target="_blank" rel="external"><img src="http://www.dewavrin.info/images/custom/jsf_facelets_visual.JPG" alt=""></a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/impressive-jboss-tools-on-eclipse-europa/" data-id="5dygwoe0nt9ulij2" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/impressive-jboss-tools-on-eclipse-europa/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eclipse/">eclipse</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ants-regexp-task-in-a-maven-pom-file" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/ants-regexp-task-in-a-maven-pom-file/" class="article-date">
  <time datetime="2007-06-04T22:00:00.000Z" itemprop="datePublished">Jun 5 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/ants-regexp-task-in-a-maven-pom-file/">Ant&#39;s replaceregexp task in a maven pom file</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Since it can be tricky, here’s how Ant’s regexp task can be used in a maven pom file:</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>maven-antrun-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">executions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">execution</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="title">phase</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">tasks</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="title">echo</span>&gt;</span>Online uncomment of ${basedir}/src/main/resources/beanRefContext.xml<span class="tag">&lt;/<span class="title">echo</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="title">copy</span>&gt;</span></div><div class="line">              file="${basedir}/src/main/resources/beanRefContext.xml"</div><div class="line">              todir="${basedir}/target/classes" /&amp;gt;</div><div class="line">          <span class="tag">&lt;<span class="title">replaceregexp</span>&gt;</span></div><div class="line">              file="${basedir}/target/classes/beanRefContext.xml"</div><div class="line">              match="&amp;lt;!--s*(&amp;lt;[^-{2}]+)--&amp;gt;" replace="1"</div><div class="line">              byline="true" /&amp;gt;</div><div class="line">        <span class="tag">&lt;/<span class="title">replaceregexp</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="title">copy</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">tasks</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">goals</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">goal</span>&gt;</span>run<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">execution</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">executions</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>ant<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>ant-nodeps<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.6.5<span class="tag">&lt;/<span class="title">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>ant<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>ant-apache-regexp<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.6.5<span class="tag">&lt;/<span class="title">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>jakarta-regexp<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>jakarta-regexp<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="title">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></div></pre></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/ants-regexp-task-in-a-maven-pom-file/" data-id="f492cwau4vhm8sx4" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/ants-regexp-task-in-a-maven-pom-file/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ant/">ant</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-groovy-use-case" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/a-groovy-use-case/" class="article-date">
  <time datetime="2007-06-03T22:00:00.000Z" itemprop="datePublished">Jun 4 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/a-groovy-use-case/">A groovy use case</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I recently discovered Spring’s ability to declare beans that are script-based. This feature can be used to mock business interfaces with Groovy implementations. In a JavaEE container where startup and redeployment can take a while, it can be very useful, in pre-integration tests, to change the behaviour of your business services especially without redeploying the whole EAR or restarting the server.Here’s an example declaration:</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"MockServiceImpl"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scripting.groovy.GroovyScriptFactory"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"${mocks.path}/MockServiceImpl.groovy"</span>&gt;</span><span class="tag">&lt;/<span class="title">constructor-arg</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scripting.support.ScriptFactoryPostProcessor"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"defaultRefreshCheckDelay"</span> <span class="attribute">value</span>=<span class="value">"2"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>The “defaultRefreshCheckDelay” parameter sets the delay in seconds between checks for modifications of the script. and the groovy script:</p>
<figure class="highlight groovy"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockServiceImpl</span> <span class="keyword">implements</span> <span class="title">Service</span> </span>{</div><div class="line">    ProductsReturn returnCase1 = <span class="keyword">new</span> ProductsReturn(fetchDate:Calendar.getInstance(),products:[<span class="keyword">new</span> Product(id:<span class="number">1</span>,name:<span class="string">"good"</span>)])</div><div class="line">    ProductsReturn emptyReturn = <span class="keyword">new</span> ProductsReturn(fetchDate:Calendar.getInstance(),products:[])</div><div class="line"> </div><div class="line">    ReturnObject listProductsForUser(String userId) {</div><div class="line">         <span class="keyword">return</span>  returnCase1</div><div class="line">    }</div></pre></figure>

<p>I see many benefits in this solution:</p>
<ul>
<li>hot-swapping implementations without redeployment.</li>
<li>returned objects can be dynamically generated. For instance if you want to return objects depending only one a given parameter it can be done easily.</li>
<li>more concise than XML (see <a href="http://azote.sourceforge.net/xmlstubs.html" target="_blank" rel="external">xmlstubs</a> a XML based mocking solution).</li>
</ul>
<p>On a side note, groovy requires ASM 2.2.2 library so if you use hibernate use the cglib with no dependency library which includes asm classes in renamed packages. Also use Spring 2.0.3+ if you use AspectJ pointcut declarations or you can expect errors.With maven profiles it ‘s easy to build a mock and non-mocked service layer of an EAR.Note that you can still inject the real implementations if you want to delegate work to it.</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"MockServiceImpl"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scripting.groovy.GroovyScriptFactory"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"${mocks.path}/MockServiceImpl.groovy"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"ServiceImpl"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>On an other side note, I like both Groovy and JRuby but now tend to prefer Groovy because it leverages my knowledge of Java API. With Ruby i spend too much time finding the reference web site how to achieve things that i do almost naturally in Java. OTH, Ruby has its core API use closures. Closures are tightly integrated and tend to favor loose coupling.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info//blog/a-groovy-use-case/" data-id="4l3dzer8wsiss5el" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info//blog/a-groovy-use-case/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/groovy/">groovy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/java/">&laquo; Prev</a><a class="page-number" href="/categories/java/">1</a><span class="page-number current">2</span><a class="page-number" href="/categories/java/page/3/">3</a><a class="page-number" href="/categories/java/page/4/">4</a><a class="extend next" rel="next" href="/categories/java/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
<div class="widget-wrap">
   <h3 class="widget-title">tweets</h3>
   <div class="widget">
               <a class="twitter-timeline"  
                   href="https://twitter.com/lucdew" 
                   data-chrome="noheader nofooter noborders transparent"
                   data-tweet-limit="5"
                   data-widget-id="518280804359610368">Tweets by @lucdew</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
   </div>
</div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ant/" style="font-size: 12.00px;">ant</a><a href="/tags/aop/" style="font-size: 12.00px;">aop</a><a href="/tags/aspectj/" style="font-size: 12.00px;">aspectj</a><a href="/tags/asterisk/" style="font-size: 10.00px;">asterisk</a><a href="/tags/axis/" style="font-size: 10.00px;">axis</a><a href="/tags/blog/" style="font-size: 10.00px;">blog</a><a href="/tags/eclipse/" style="font-size: 12.00px;">eclipse</a><a href="/tags/ejb/" style="font-size: 10.00px;">ejb</a><a href="/tags/firewall/" style="font-size: 16.00px;">firewall</a><a href="/tags/freebsd/" style="font-size: 10.00px;">freebsd</a><a href="/tags/grails/" style="font-size: 10.00px;">grails</a><a href="/tags/groovy/" style="font-size: 12.00px;">groovy</a><a href="/tags/gwt/" style="font-size: 10.00px;">gwt</a><a href="/tags/htmlunit/" style="font-size: 10.00px;">htmlunit</a><a href="/tags/jBPM/" style="font-size: 12.00px;">jBPM</a><a href="/tags/java/" style="font-size: 16.00px;">java</a><a href="/tags/jaxb/" style="font-size: 10.00px;">jaxb</a><a href="/tags/jdbc/" style="font-size: 12.00px;">jdbc</a><a href="/tags/jibx/" style="font-size: 10.00px;">jibx</a><a href="/tags/jms/" style="font-size: 10.00px;">jms</a><a href="/tags/jmx/" style="font-size: 10.00px;">jmx</a><a href="/tags/jpa/" style="font-size: 10.00px;">jpa</a><a href="/tags/jrockit/" style="font-size: 10.00px;">jrockit</a><a href="/tags/jsf/" style="font-size: 10.00px;">jsf</a><a href="/tags/jta/" style="font-size: 10.00px;">jta</a><a href="/tags/ldap/" style="font-size: 10.00px;">ldap</a><a href="/tags/lingo/" style="font-size: 10.00px;">lingo</a><a href="/tags/maven/" style="font-size: 18.00px;">maven</a><a href="/tags/misc/" style="font-size: 18.00px;">misc</a><a href="/tags/osgi/" style="font-size: 10.00px;">osgi</a><a href="/tags/quartz/" style="font-size: 10.00px;">quartz</a><a href="/tags/rails/" style="font-size: 10.00px;">rails</a><a href="/tags/ruby/" style="font-size: 10.00px;">ruby</a><a href="/tags/seam/" style="font-size: 14.00px;">seam</a><a href="/tags/security/" style="font-size: 14.00px;">security</a><a href="/tags/snmp/" style="font-size: 10.00px;">snmp</a><a href="/tags/spring/" style="font-size: 20.00px;">spring</a><a href="/tags/subversion/" style="font-size: 10.00px;">subversion</a><a href="/tags/svn/" style="font-size: 10.00px;">svn</a><a href="/tags/swing/" style="font-size: 10.00px;">swing</a>
    </div>
  </div>

  
    <div class="widget-wrap">
   <h3 class="widget-title">Visitors</h3>
   <div class="widget">
         <a href="http://www2.clustrmaps.com/counter/maps.php?url=http://www.dewavrin.info" id="clustrMapsLink"><img src="http://www2.clustrmaps.com/counter/index2.php?url=http://www.dewavrin.info" style="text-decoration: none; margin-bottom: 1em; border:1px solid;" onmouseover="this.style.textDecoration = 'none'" alt="Locations of visitors to this page" title="Locations of visitors to this page" id="clustrMapsImg" onError="this.onError=null; this.src='http://clustrmaps.com/images/clustrmaps-back-soon.jpg'; document.getElementById('clustrMapsLink').href='http://clustrmaps.com'" /> </a>
   </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">April 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">March 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">February 2009</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">October 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/09/">September 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/08/">August 2008</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">June 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/05/">May 2008</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">January 2008</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/12/">December 2007</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/11/">November 2007</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/08/">August 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/07/">July 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/06/">June 2007</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/02/">February 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/01/">January 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/12/">December 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/11/">November 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/06/">June 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/05/">May 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/04/">April 2006</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/02/">February 2006</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/01/">January 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/12/">December 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/10/">October 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/09/">September 2005</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/08/">August 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/07/">July 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/06/">June 2005</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/05/">May 2005</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/04/">April 2005</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/03/">March 2005</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/02/">February 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/12/">December 2004</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/10/">October 2004</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/09/">September 2004</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/08/">August 2004</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/07/">July 2004</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/04/">April 2004</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Luc Dewavrin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'lucdewavrinsblog';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>