
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Programmatic authentication in Tomcat - Luc Dewavrin's website</title>
  <meta name="author" content="Luc Dewavrin">

  
  <meta name="description" content="I had to programmatically authenticate a principal using the security realm defined in Tomcat. I needed to do so because I didn&#8217;t want to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lucdew.github.com/blog/2005/09/17/programmatic-authentication-in-tomcat">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Luc Dewavrin's website" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1239956-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Luc Dewavrin's website</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lucdew.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Programmatic Authentication in Tomcat</h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-09-17T00:00:00-04:00" pubdate data-updated="true">Sep 17<span>th</span>, 2005</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I had to programmatically authenticate a principal using the security realm defined in Tomcat. I needed to do so because I didn&#8217;t want to reinvent the wheel. But in my case the J2EE container authorizations defined in the web.xml DD didn&#8217;t fit well. I also had to programmatically verify that user belonged to a role and the realm API let you do that. The resources to which users were restricted are not URLs but actions and the authorizations are defined in a specific configuration file and not in the web.xml file. I didn&#8217;t want to have a specific URI for each action.With Weblogic server doing programmatic authentication it&#8217;s pretty easy.Just use the following code<pre lang='java'>int retcode = ServletAuthentication.weak(username,password,session);</pre>for WLS 8.1 and<pre lang='java'>int retcode =  ServletAuthentication.weak(username,password,request,response);</pre>for WLS 9For Tomcat, i managed to &#8220;mimic&#8221; containter authentication but haven&#8217;t fully been able to do it. It&#8217;s possible through JMX to access the configured realm. For instance, use the following code to retrieve the realm through a local connection to the MBean server (using JSR 160). I left commented code to access the MBean server remotely.<pre lang='java'>package com.xxx.integ2.tomcat;import java.util.HashMap;import java.util.List;import java.util.Map;import javax.management.MBeanServer;import javax.management.MBeanServerFactory;import javax.management.ObjectName;import javax.management.remote.JMXServiceURL;import javax.naming.Context;import org.apache.catalina.Manager;import org.apache.catalina.Realm;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;public class JMXHelper {public static final String SERVER_URL="service:jmx:rmi:///jndi/rmi://localhost:9004/jmxrmi";private transient final static Log LOG = LogFactory.getLog(JMXHelper.class);public static Realm getRealm() {try {            JMXServiceURL url = new JMXServiceURL(SERVER_URL);Map environment = new HashMap();environment.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.rmi.registry.RegistryContextFactory");environment.put(Context.PROVIDER_URL, "rmi://"+url.getHost()+":"+url.getPort());            //MBeanServerConnection connection = JMXConnectorFactory.connect(url,environment).getMBeanServerConnection() ;            // Retrieve MBeanserver            List mbeanServers = MBeanServerFactory.findMBeanServer(null);            MBeanServer mBeanServer = null;            if (mbeanServers != null &amp;&amp; mbeanServers.size() &gt; 0) {            mBeanServer =  (MBeanServer) mbeanServers.get(0);            }       String objName = "Catalina:j2eeType=WebModule,name=//localhost/manager,J2EEApplication=none,J2EEServer=none";       ObjectName contextObjectName = new ObjectName(objName);       Object contextManager = mBeanServer.getAttribute(contextObjectName, "manager");       //Object contextManagedResource = connection.getAttribute(contextObjectName, "managedResource");       Manager manager = (Manager)contextManager;       Realm realm = manager.getContainer().getRealm();              return realm;} catch (Exception e) {        LOG.error("A problem occured retrieving the security realm",e);} return null;}}</pre>I also had to add the following jar to the common.loader in catalina.properties file<pre lang='text'>${catalina.home}/server/lib/*.jar</pre>to be able to load the catalina API in my webapp.For remote access using the JVM&#8217;s RMI connector of the JVM&#8217;s internal MBean server, add the following options when starting the JVM:<pre lang='text'>-Dcom.sun.management.jmxremote.port=9004 (-Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.pass.file=${tomcat.home}/jmxremote.password -Dcom.sun.management.jmxremote.ssl=false</pre>The only problem is that you only delegate authentication to the JNDI realm but you are not really authenticating the user to the container. It means that method getUserPrincipal from HTTPServletRequest (<strong>request.getUserPrincipal()</strong>) will return null. One way to check that a user is authenticated would be to store the principal in the user&#8217;s session. Then write a servlet filter or Spring MVC &#8216;s interceptor checking that a principal is stored in the user&#8217;s session and redirecting to a login page in case it&#8217;s not.Interesting resources:- Portable J2EE security framework : <a href='acegisecurity.sourceforge.net/'>ACEGI security</a></p>

<ul>
<li><a href='http://weblogic.sys-con.com/read/48219.htm'>Weblogic programmatic authentication</a> (user/password and certificate authentication)</li>

<li><a href='http://java.sun.com/j2se/1.5.0/docs/guide/jmx/index.html'>JMX and JSR 160 in Java 5</a></li>
</ul></div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Luc Dewavrin</span></span>

      








  


<time datetime="2005-09-17T00:00:00-04:00" pubdate data-updated="true">Sep 17<span>th</span>, 2005</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://lucdew.github.com/blog/2005/09/17/programmatic-authentication-in-tomcat/" data-via="lucdew" data-counturl="http://lucdew.github.com/blog/2005/09/17/programmatic-authentication-in-tomcat/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2005/09/17/memory-leaks-hunting-articles-2/" title="Previous Post: Memory leaks hunting articles">&laquo; Memory leaks hunting articles</a>
      
      
        <a class="basic-alignment right" href="/blog/2005/10/25/persistent-quartz-jobs-with-spring-2/" title="next Post: Persistent Quartz Jobs with Spring">Persistent Quartz Jobs with Spring &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2009/09/16/last-post/">Last Post</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/05/05/osgi-survey/">OSGI survey</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/04/27/mimic-facelet-layouts-in-grails/">Mimic facelet layouts in grails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/04/20/acquisition-de-sun-par-oracle/">Acquisition de Sun par Oracle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/03/30/seam-usage-in-production/">Seam usage in production</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("lucdew", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/lucdew" class="twitter-follow-button" data-show-count="false">Follow @lucdew</a>
  
</section>




<section>
  <h1>Visitors</h1>
  <p><a href="http://www2.clustrmaps.com/counter/maps.php?url=http://www.dewavrin.info" id="clustrMapsLink"><img src="http://www2.clustrmaps.com/counter/index2.php?url=http://www.dewavrin.info" style="text-decoration: none; margin-bottom: 1em; border:1px solid;" onmouseover="this.style.textDecoration = 'none'" alt="Locations of visitors to this page" title="Locations of visitors to this page" id="clustrMapsImg" onError="this.onError=null; this.src='http://clustrmaps.com/images/clustrmaps-back-soon.jpg'; document.getElementById('clustrMapsLink').href='http://clustrmaps.com'" /> </a>
</p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Luc Dewavrin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lucdewavrinsblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
