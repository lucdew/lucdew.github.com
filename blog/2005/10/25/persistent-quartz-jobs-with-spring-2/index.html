
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Persistent Quartz Jobs with Spring - Luc Dewavrin's website</title>
  <meta name="author" content="Luc Dewavrin">

  
  <meta name="description" content="I developped a small web Spring MVC application for the company I work for that allowed with other things to schedule executions of Ant scripts ( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lucdew.github.com/blog/2005/10/25/persistent-quartz-jobs-with-spring-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Luc Dewavrin's website" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1239956-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Luc Dewavrin's website</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lucdew.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Persistent Quartz Jobs With Spring</h1>
    
    
      <p class="meta">
        








  


<time datetime="2005-10-25T00:00:00-04:00" pubdate data-updated="true">Oct 25<span>th</span>, 2005</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I developped a small web Spring MVC application for the company I work for that allowed with other things to schedule executions of Ant scripts (reinventing the wheel&#8230;)<a href='http://www.opensymphony.com/quartz/'>Quartz</a> is the natural choice in the J2EE world to schedule tasks and allows to express the schedule time (or period) using a Unix CRON pattern. And also Quartz can persist schedule jobs to database.A Quartz job has to implement the <a href='http://www.opensymphony.com/quartz/api/org/quartz/Job.html'>Job</a> interface and for persistant jobs the <a href='http://www.opensymphony.com/quartz/api/org/quartz/StatefulJob.html'>StatefulJob</a> interface. The jobs are scheduled using a <a href='http://www.opensymphony.com/quartz/api/org/quartz/Scheduler.html'>Scheduler</a> implementation. Spring provides a Scheduler factory (org.springframework.scheduling.quartz.SchedulerFactoryBean) and here I&#8217;ll show how to declare the declare a persistent scheduler in Spring&#8217;s application context that will store jobs to database (and allow all CRUD operations).Before that Quartz provide DDL scripts that create the necessary tables for many RDBMS, so you need to apply them on your database.Let&#8217;s declare below the Scheduler using Spring&#8217;s factory (SchedulerFactoryBean). Note that the properties are set here for MySQL and some optimized versions of the declared classes exist for other RDBMSUpdate: the job store class JobStoreTX handles transactions by itself. Sousing it with a Spring transactional proxy like I did was useless and the schedulertarget could have been used directly. Instead use the JobStoreCMT with a Spring JTAtransaction manager and a JTA aware datasource (see below). Quartz doc says:_If you need Quartz to work along with other transactions (i.e. within a J2EE application server), then you should use JobStoreCMT - in which case Quartz will let the app server container manage the transactions._ .<pre lang='xml'><bean class='org.springframework.scheduling.quartz.SchedulerFactoryBean' id='schedulertarget'> <property name='quartzProperties'><props><prop key='org.quartz.jobStore.class'>org.quartz.impl.jdbcjobstore.JobStoreCMT</prop><prop key='org.quartz.jobStore.driverDelegateClass'>org.quartz.impl.jdbcjobstore.StdJDBCDelegate</prop><prop key='org.quartz.jobStore.tablePrefix'>QRTZ_</prop></props></property><property name='dataSource'><ref bean='${datasource}' /></property></bean></pre>Then make methods of the scheduler transactional with a JTA transaction manager.<pre lang='xml'><bean class='org.springframework.jndi.JndiObjectFactoryBean' id='dataSource'>     <property name='jndiName'>        <value>java:comp/env/jdbc/myds</value>     </property></bean><bean class='org.springframework.transaction.jta.JtaTransactionManager' id='transactionManager'><property name='dataSource' ref='${datasource}' /></bean>   <bean class='org.springframework.transaction.interceptor.TransactionProxyFactoryBean' id='scheduler'><property name='transactionManager' ref='transactionManager' /><property name='target' ref='schedulertarget' /><property name='transactionAttributes'><props><prop key='*'>PROPAGATION_REQUIRED</prop></props></property></bean></pre>Then you can inject directly the scheduler to a Spring MVC controller and programmatically have it doing CRUD operations on Job schedules (or use a cleaner approach with a DAO),etc.</p></div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Luc Dewavrin</span></span>

      








  


<time datetime="2005-10-25T00:00:00-04:00" pubdate data-updated="true">Oct 25<span>th</span>, 2005</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://lucdew.github.com/blog/2005/10/25/persistent-quartz-jobs-with-spring-2/" data-via="lucdew" data-counturl="http://lucdew.github.com/blog/2005/10/25/persistent-quartz-jobs-with-spring-2/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2005/09/17/programmatic-authentication-in-tomcat/" title="Previous Post: Programmatic authentication in Tomcat">&laquo; Programmatic authentication in Tomcat</a>
      
      
        <a class="basic-alignment right" href="/blog/2005/12/24/article-on-spring-and-aop-2/" title="next Post: Article on Spring and AOP">Article on Spring and AOP &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2009/09/16/last-post/">Last Post</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/05/05/osgi-survey/">OSGI survey</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/04/27/mimic-facelet-layouts-in-grails/">Mimic facelet layouts in grails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/04/20/acquisition-de-sun-par-oracle/">Acquisition de Sun par Oracle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2009/03/30/seam-usage-in-production/">Seam usage in production</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("lucdew", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/lucdew" class="twitter-follow-button" data-show-count="false">Follow @lucdew</a>
  
</section>




<section>
  <h1>Visitors</h1>
  <p><a href="http://www2.clustrmaps.com/counter/maps.php?url=http://www.dewavrin.info" id="clustrMapsLink"><img src="http://www2.clustrmaps.com/counter/index2.php?url=http://www.dewavrin.info" style="text-decoration: none; margin-bottom: 1em; border:1px solid;" onmouseover="this.style.textDecoration = 'none'" alt="Locations of visitors to this page" title="Locations of visitors to this page" id="clustrMapsImg" onError="this.onError=null; this.src='http://clustrmaps.com/images/clustrmaps-back-soon.jpg'; document.getElementById('clustrMapsLink').href='http://clustrmaps.com'" /> </a>
</p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Luc Dewavrin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lucdewavrinsblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
