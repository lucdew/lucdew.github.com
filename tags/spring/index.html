<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: spring | Luc Dewavrin&#39;s weblog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <link rel="alternative" href="/atom.xml" title="Luc Dewavrin&#39;s weblog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1239956-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Luc Dewavrin&#39;s weblog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-github-link" class="nav-icon" href="https://github.com/lucdew" target="_blank"></a>
        <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/lucdew" target="_blank"></a>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://www.dewavrin.info"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-springsource-assouplit-sa-politique-de-maintenance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/springsource-assouplit-sa-politique-de-maintenance/" class="article-date">
  <time datetime="2008-10-07T22:00:00.000Z" itemprop="datePublished">Oct 8 2008</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/springsource-assouplit-sa-politique-de-maintenance/">SpringSource assouplit sa politique de maintenance</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Bon SpringSource a décidé de changer de nouveau la politique de maintenance  de Spring après le tollé suscité parmi ses utilisateurs par la <a href="/?p=248">récente annonce</a>. Plus de limite de 3 mois pour les versions communautaires. Une version majeure sera maintenue pour la communauté jusqu’à la sortie en Release Candidate de la version suivante. +d’infos sur le blog <a href="http://blog.springsource.com/2008/10/07/a-question-of-balance-tuning-the-maintenance-policy/" target="_blank" rel="external">SpringSource</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/springsource-assouplit-sa-politique-de-maintenance/" data-id="zr9x14h2yv402t92" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/springsource-assouplit-sa-politique-de-maintenance/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-changement-de-licence-spring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/changement-de-licence-spring/" class="article-date">
  <time datetime="2008-09-20T22:00:00.000Z" itemprop="datePublished">Sep 21 2008</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/changement-de-licence-spring/">Spring maintenant payant</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Oui la nouvelle du week-end ou plutot de fin de semaine sur le <a href="http://newblog.springsource.com/2008/05/27/open-source-open-strategy-the-springsource-manifesto/" target="_blank" rel="external">changement de licence de Spring</a> <strong>me reste en travers de la gorge</strong>, même si j’en comprends les raisons.</p>
<p> Mais d’un coup je me sens coupable d’avoir poussé depuis 2004 à l’utilisation de Spring sur plusieurs projets et d’en avoir été le défenseur auprès de certains collègues réticents sur les principes d’injection de dépendances, de conteneur léger et même d’AOP. Sur mes 2 derniers projets, j’ai même introduit Spring Security (anciennement ACEGI) et utilisé Spring MVC pour une petite application interne chez mon employeur précédent. Et oui, le changement de licence s’applique aussi à tous ces projets.Cela me fait maintenant me re-questionner sur l’utilisation de ce framework.</p>
<p>D’abord pourquoi Spring ? Logiquement après avoir lu les livres de Rod Johnson “J2EE design and development” et “J2EE Development without EJB” son utilisation semblait être une vrai alternatives aux Ejb 2.x pour les raisons suivantes :</p>
<ul>
<li>des objets et services métiers n’implémentant aucune interface technique (juste des POJO).</li>
<li>l’injection de dépendances favorisant le couplage faible entre les objets.</li>
<li>les tests unitaires sans déployer dans le conteneur EJB accélérant ainsi les phases de test.</li>
<li>la rapidité de démarrage du conteneur Spring pemettant de l’utiliser en dehors d’un serveur application.<br>Mais Spring est aussi utilisé maintenant pour toutes ses fonctionnalités qui facilitent le développement d’application JavaEE :</li>
<li>son intercepteurs transactionnels et son annotation @Transactional</li>
<li>l’accès aux services des serveurs d’application par simple déclaration  (j2ee:jndi-lookup)</li>
<li><p>la création de proxy sur des Ejb (2.1, 3.0), Web-Services (JAX-RPC et JAXWS) .<br>En fait, j’ai en fait toujours été très satisfait de Spring Core et impressionné par sa stabilité et son excellente documentation tout cela en opensource et gratuit. Les applications développées avec étaient même plus portables que les traditionnelles applications J2EE.  Mais la lune de miel a une fin et je pense maintenant que je vais devoir m’intéresser aux alternatives, car je vois mal certains clients payer pour une librairie (cela changera peut-être pour avec Spring dm Server).</p>
<p><strong>Les alternatives</strong></p>
</li>
</ul>
<p>Pour moi la + évidente :</p>
<ul>
<li><p><strong>JavaEE 5 et les EJB 3</strong><br>Et oui avec des conteneurs d’EJB en mode embedded pouvant être utilisés pour les tests et démarrant en quelques lignes de codes ( voir par exemple <a href="http://openejb.apache.org" target="_blank" rel="external">OpenEJB </a>de la fondation Apache ou encore JBoss embedded ).  De + cette solution a l’immense mérite d’être standard.Maintenant techniquement, le mécanisme d’interception d’EJB 3 n’est pas aussi riche que celui proposé par Spring et son support d’AspectJ. Le mécanisme ne permet d’injecter uniquement des Ejbs ou des ressources JNDI. Mais au moins les tests sans déploiement sont possibles, le code simplifié et épuré. De +, Ejb 3.1 apportent aussi son lot de nouveautés comme l’annotation @Singleton ou la non-obligation de créer une interface métier.</p>
</li>
<li><p><strong>Guice</strong></p>
</li>
</ul>
<p>Peut-être un peu jeune et n’est qu’un “IOC container” mais pourquoi pas pour une utilisation pour des applications standalone. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/changement-de-licence-spring/" data-id="y5pk6fr2bct89nuj" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/changement-de-licence-spring/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spring-entitymanagerfactory-jta-and-non-jta-modes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/spring-entitymanagerfactory-jta-and-non-jta-modes/" class="article-date">
  <time datetime="2008-06-22T22:00:00.000Z" itemprop="datePublished">Jun 23 2008</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/general/">general</a>►<a class="article-category-link" href="/categories/java/general/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/spring-entitymanagerfactory-jta-and-non-jta-modes/">Spring entityManagerFactory in jta and non-jta modes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This blog post is about using JPA with Spring in 2 contexts :</p>
<ul>
<li>production with a JTA transaction manager</li>
<li>testing with transactions handled by jpa transaction manager.<br>It has been inspired by <a href="http://erich.soomsam.net/2007/04/24/spring-jpa-and-jta-with-hibernate-and-jotm/" target="_blank" rel="external">Erich Soomsam blog post</a>You can achieve such configuration with a PersistenceUnitPostProcessor having a single persistence.xml file and 2 Spring context files (1 for each environment).Since you are likely to have at least 2 different Spring dataSource definitions : 1 for production that performs a JNDI lookup to find a bound datasource and 1 for development that uses a local and Spring declared datasource backed by a JDBC connection pool (C3p0 or DBCP), place the entityManager declaration in the same file as the datasource declaration. Let’s say that the default persistence.xml use the non-jta datasource:<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">persistence</span> <span class="attribute">xmlns</span>=<span class="value">"http://java.sun.com/xml/ns/persistence"</span></span></div><div class="line">	<span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">	<span class="attribute">xsi:schemalocation</span>=<span class="value">"http://java.sun.com/xml/ns/persistence    http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"</span></div><div class="line">	<span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="title">persistence-unit</span> <span class="attribute">transaction-type</span>=<span class="value">"RESOURCE_LOCAL"</span></span></div><div class="line">		<span class="attribute">name</span>=<span class="value">"seamphony"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="title">properties</span>&gt;</span>     <span class="comment">&lt;!-- Scan for annotated classes and Hibernate mapping XML files --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"class, hbm"</span> <span class="attribute">name</span>=<span class="value">"hibernate.archive.autodetection"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"hibernate.dialect"</span> <span class="attribute">value</span>=<span class="value">"org.hibernate.dialect.MySQLDialect"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">properties</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">persistence-unit</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">persistence</span>&gt;</span></div></pre></figure><br>Here’s how you can use Spring to post process the persistence unit and configure it for production (here with MySQL datasource and JBoss Transaction Manager):<br><figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span></span></div><div class="line">	class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</div><div class="line">	id="entityManagerFactory"&gt;</div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">ref</span>=<span class="value">"dataSource"</span> <span class="attribute">name</span>=<span class="value">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jpaVendorAdapter"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"MYSQL"</span> <span class="attribute">name</span>=<span class="value">"database"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"showSql"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"org.hibernate.dialect.MySQLDialect"</span> <span class="attribute">name</span>=<span class="value">"databasePlatform"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jpaPropertyMap"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">map</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"org.hibernate.transaction.JBossTransactionManagerLookup"</span></span></div><div class="line">		<span class="attribute">key</span>=<span class="value">"hibernate.transaction.manager_lookup_class"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">key</span>=<span class="value">"hibernate.transaction.flush_before_completion"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">key</span>=<span class="value">"hibernate.transaction.auto_close_session"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"jta"</span> <span class="attribute">key</span>=<span class="value">"hibernate.current_session_context_class"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">entry</span> <span class="attribute">value</span>=<span class="value">"auto"</span> <span class="attribute">key</span>=<span class="value">"hibernate.connection.release_mode"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">entry</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">map</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"persistenceUnitPostProcessors"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"JtaPersistenceUnitPostProcessor"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"jtaMode"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">property</span> <span class="attribute">ref</span>=<span class="value">"dataSource"</span> <span class="attribute">name</span>=<span class="value">"jtaDataSource"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">list</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">property</span>&gt;</span><span class="comment">&lt;!-- Datasource Lookup --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.jndi.JndiObjectFactoryBean"</span> <span class="attribute">id</span>=<span class="value">"dataSource"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"resourceRef"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">value</span>&gt;</span>false<span class="tag">&lt;/<span class="title">value</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jndiName"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">value</span>&gt;</span>java:/MyDS<span class="tag">&lt;/<span class="title">value</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span><span class="comment">&lt;!-- Transaction Manager --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.transaction.jta.JtaTransactionManager"</span></span></div><div class="line">	<span class="attribute">id</span>=<span class="value">"transactionManager"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"java:/TransactionManager"</span> <span class="attribute">name</span>=<span class="value">"transactionManagerName"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">value</span>=<span class="value">"false"</span> <span class="attribute">name</span>=<span class="value">"autodetectUserTransaction"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

</li>
</ul>
<p>Here’s the class that reads the jta mode property and configure the transaction type accordingly:</p>
<figure class="highlight java"><pre><div class="line"><span class="keyword">import</span> javax.persistence.spi.PersistenceUnitTransactionType;</div><div class="line"><span class="keyword">import</span> javax.sql.DataSource;</div><div class="line"><span class="keyword">import</span> org.springframework.orm.jpa.persistenceunit.MutablePersistenceUnitInfo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.orm.jpa.persistenceunit.PersistenceUnitPostProcessor;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JtaPersistenceUnitPostProcessor</span> <span class="keyword">implements</span></span></div><div class="line">		<span class="title">PersistenceUnitPostProcessor</span> {</div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> jtaMode = <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">private</span> DataSource jtaDataSource;</div><div class="line">	<span class="keyword">private</span> PersistenceUnitTransactionType transacType = PersistenceUnitTransactionType.RESOURCE_LOCAL;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessPersistenceUnitInfo</span>(</div><div class="line">			MutablePersistenceUnitInfo mutablePersistenceUnitInfo) {</div><div class="line">		<span class="keyword">if</span> (jtaMode) {</div><div class="line">			transacType = PersistenceUnitTransactionType.JTA;</div><div class="line">			mutablePersistenceUnitInfo</div><div class="line">					.setJtaDataSource(<span class="keyword">this</span>.getJtaDataSource());</div><div class="line">		}</div><div class="line">		mutablePersistenceUnitInfo.setTransactionType(transacType);</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isJtaMode</span>() {</div><div class="line">		<span class="keyword">return</span> jtaMode;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJtaMode</span>(<span class="keyword">boolean</span> jtaMode) {</div><div class="line">		<span class="keyword">this</span>.jtaMode = jtaMode;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> DataSource <span class="title">getJtaDataSource</span>() {</div><div class="line">		<span class="keyword">return</span> jtaDataSource;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJtaDataSource</span>(DataSource jtaDataSource) {</div><div class="line">		<span class="keyword">this</span>.jtaDataSource = jtaDataSource;</div><div class="line">	}</div><div class="line">}</div></pre></figure>

<p>Spring really helps tuning your persistence unit for different environments. It could be achieved by a custom build task that could alter the persistence.xml file but since this example assumes that Spring is already used, it can be avoided.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/spring-entitymanagerfactory-jta-and-non-jta-modes/" data-id="dl3ktycejtqnt5e6" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/spring-entitymanagerfactory-jta-and-non-jta-modes/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jpa/">jpa</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-groovy-use-case" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/a-groovy-use-case/" class="article-date">
  <time datetime="2007-06-03T22:00:00.000Z" itemprop="datePublished">Jun 4 2007</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>►<a class="article-category-link" href="/categories/java/tech/">tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/a-groovy-use-case/">A groovy use case</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I recently discovered Spring’s ability to declare beans that are script-based. This feature can be used to mock business interfaces with Groovy implementations. In a JavaEE container where startup and redeployment can take a while, it can be very useful, in pre-integration tests, to change the behaviour of your business services especially without redeploying the whole EAR or restarting the server.Here’s an example declaration:</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"MockServiceImpl"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scripting.groovy.GroovyScriptFactory"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"${mocks.path}/MockServiceImpl.groovy"</span>&gt;</span><span class="tag">&lt;/<span class="title">constructor-arg</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scripting.support.ScriptFactoryPostProcessor"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"defaultRefreshCheckDelay"</span> <span class="attribute">value</span>=<span class="value">"2"</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>The “defaultRefreshCheckDelay” parameter sets the delay in seconds between checks for modifications of the script. and the groovy script:</p>
<figure class="highlight groovy"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockServiceImpl</span> <span class="keyword">implements</span> <span class="title">Service</span> </span>{</div><div class="line">    ProductsReturn returnCase1 = <span class="keyword">new</span> ProductsReturn(fetchDate:Calendar.getInstance(),products:[<span class="keyword">new</span> Product(id:<span class="number">1</span>,name:<span class="string">"good"</span>)])</div><div class="line">    ProductsReturn emptyReturn = <span class="keyword">new</span> ProductsReturn(fetchDate:Calendar.getInstance(),products:[])</div><div class="line"> </div><div class="line">    ReturnObject listProductsForUser(String userId) {</div><div class="line">         <span class="keyword">return</span>  returnCase1</div><div class="line">    }</div></pre></figure>

<p>I see many benefits in this solution:</p>
<ul>
<li>hot-swapping implementations without redeployment.</li>
<li>returned objects can be dynamically generated. For instance if you want to return objects depending only one a given parameter it can be done easily.</li>
<li>more concise than XML (see <a href="http://azote.sourceforge.net/xmlstubs.html" target="_blank" rel="external">xmlstubs</a> a XML based mocking solution).</li>
</ul>
<p>On a side note, groovy requires ASM 2.2.2 library so if you use hibernate use the cglib with no dependency library which includes asm classes in renamed packages. Also use Spring 2.0.3+ if you use AspectJ pointcut declarations or you can expect errors.With maven profiles it ‘s easy to build a mock and non-mocked service layer of an EAR.Note that you can still inject the real implementations if you want to delegate work to it.</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"MockServiceImpl"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scripting.groovy.GroovyScriptFactory"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"${mocks.path}/MockServiceImpl.groovy"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">value</span>=<span class="value">"ServiceImpl"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>On an other side note, I like both Groovy and JRuby but now tend to prefer Groovy because it leverages my knowledge of Java API. With Ruby i spend too much time finding the reference web site how to achieve things that i do almost naturally in Java. OTH, Ruby has its core API use closures. Closures are tightly integrated and tend to favor loose coupling.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/a-groovy-use-case/" data-id="4l3dzer8wsiss5el" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/a-groovy-use-case/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/groovy/">groovy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spring-and-lingo-easy-jms-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/spring-and-lingo-easy-jms-2/" class="article-date">
  <time datetime="2006-06-12T22:00:00.000Z" itemprop="datePublished">Jun 13 2006</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/spring-and-lingo-easy-jms-2/">Spring and Lingo = Easy JMS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>With <a href="http://lingo.codehaus.org/" target="_blank" rel="external">Lingo</a> from codeHaus, Spring remoting can be extended to support JMS.Here’s a great article on <a href="http://www.jroller.com/page/sjivan?entry=asynchronous_calls_and_callbacks_using" target="_blank" rel="external">Saniv Jivan’s blog</a> that shows some of its capabilities (synchronous calls over JMS and asynchronous callbacks).</p>
<p>One feature really seducing is asynchronous callbacks over JMSwith POJOS (without a single line of JMS code).The Lingo site does not provide much documentation on itso thanks for the author of this nice article.</p>
<p>We applied this technique for our build system to distribute loadon different machines to speed up the process (we only have mono processor build machines) and gets informed when tasks are done via callbacks.We used Spring 2.0M4 and ActiveMQ 3.2.2 in standalone mode.</p>
<p>Note that I had troubles to make it run with Websphere MQ 5.3First, recent MQ JMS 1.1 compliant Jars must be used anda misinterpretation of the JMS specs by Websphere seems to breakthe Lingo Spring JMS service exporter see<a href="http://opensource.atlassian.com/projects/spring/browse/SPR-1324" target="_blank" rel="external">http://opensource.atlassian.com/projects/spring/browse/SPR-1324</a>which is for JMS templates but can also be applied to lingo.</p>
<p>Here’s the diff of org.logicblaze.lingo.jms.JmsServiceExporter between unpatched and patched version for Websphere MQ:</p>
<figure class="highlight text"><pre><div class="line">diff -aur lingo-1.1/src/java/org/logicblaze/lingo/jms/JmsServiceExporter.java li</div><div class="line">ngo-1.1-patch/src/java/org/logicblaze/lingo/jms/JmsServiceExporter.java</div><div class="line"><span class="header">--- lingo-1.1/src/java/org/logicblaze/lingo/jms/JmsServiceExporter.java 2006-06-</span></div><div class="line">13 13:45:12.716722400 +0200</div><div class="line"><span class="header">+++ lingo-1.1-patch/src/java/org/logicblaze/lingo/jms/JmsServiceExporter.java200</span></div><div class="line">6-06-13 13:44:49.899847100 +0200</div><div class="line"><span class="chunk">@@ -180,7 +180,7 @@</span></div><div class="line"> </div><div class="line">}</div><div class="line">else {</div><div class="line"><span class="deletion">-            return session.createConsumer(destination, messageSelector, noLocal</span></div><div class="line">);</div><div class="line"><span class="addition">+            return session.createConsumer(destination, messageSelector);</span></div><div class="line">}</div><div class="line">}</div></pre></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/spring-and-lingo-easy-jms-2/" data-id="3ooaghjin8wpfkb9" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/spring-and-lingo-easy-jms-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jms/">jms</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lingo/">lingo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-maven-spring-20-pom-in-repositories-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/maven-spring-20-pom-in-repositories-2/" class="article-date">
  <time datetime="2006-04-26T22:00:00.000Z" itemprop="datePublished">Apr 27 2006</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/maven-spring-20-pom-in-repositories-2/">Maven Spring 2.0 POM in repositories</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>At last !</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/maven-spring-20-pom-in-repositories-2/" data-id="c269ygjahuuo1jxo" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/maven-spring-20-pom-in-repositories-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/">maven</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spring-aop-and-mvc-authorization-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/spring-aop-and-mvc-authorization-2/" class="article-date">
  <time datetime="2006-04-20T22:00:00.000Z" itemprop="datePublished">Apr 21 2006</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/spring-aop-and-mvc-authorization-2/">Spring AOP and MVC authorization</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>With Spring and a bunch of AOP I’ll show how it’s easy to add protectionsof your business components and notify the view that the user is not authorizedto perform a specific action.This example relies on Spring 2.0 and Spring MVC for the presentation layer.Let’s take an example of a service that executes jobs whose class is named JobExecutorService.This service has methods to add jobs in a Job queue, remove a job from the queueor stop a running job. We would like to authorize only owners of a job to remove the job or stop it. The jobs are persistent (to recover from failure).</p>
<p><u>1) Defining the authorization aspect</u><br>Let’s define in Spring’s application context a Job authorization advice and inject it a Job DAO to access persistent jobs.</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"jobAuthorizationAspect"</span> <span class="attribute">class</span>=<span class="value">"security.JobAuthorizationAspect"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jobDAO"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">ref</span> <span class="attribute">bean</span>=<span class="value">"jobDAO"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure><br>Here’s below the simplified code of the bean advice which is just a POJOwhich benefits from injection.When the user doesn’t own the Job an AuthorizationException is thrown.We’ll see later how to deal with the exception.<br><figure class="highlight java"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JobAuthorizationAspect</span> </span>{</div><div class="line"> </div><div class="line">JobDAO jobDAO;</div><div class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> Log LOG =LogFactory.getLog(JobAuthorizationAspect.class);</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJobDAO</span>(JobDAO jobDAO) {</div><div class="line"><span class="keyword">this</span>.jobDAO= jobDAO;</div><div class="line">}</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkForAuthorization</span>(Job job) {</div><div class="line"><span class="keyword">boolean</span> authorized = <span class="keyword">false</span>;</div><div class="line"> </div><div class="line">UserContext userCtx = ContextMgr.getUserContext();</div><div class="line"> </div><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != userCtx) {</div><div class="line">Job job = jobDAO.getJobById(job.getId());</div><div class="line"><span class="comment">// If user launched Job, he's allowed to perform operations on it</span></div><div class="line"><span class="keyword">if</span> ((job.getState() == Job.STATE.RUNNING || job.getState() == Job.STATE.STOPPED || job.getState() == job.getState().ENDED) &amp;&amp; job.getOwner().equals(userCtx.getPrincipal().getName())) authorized =<span class="keyword">true</span>;</div><div class="line">}</div><div class="line">}</div><div class="line"><span class="keyword">else</span> {</div><div class="line">LOG.warn(<span class="string">"user context or job context have not been found"</span>);</div><div class="line">}</div><div class="line"><span class="keyword">if</span> (! authorized ) {</div><div class="line">LOG.warn(<span class="string">"user not authorized"</span>);</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> AuthorizationException(<span class="string">"jobaction.notauthorized"</span>,<span class="keyword">new</span> Object[]{},<span class="string">"this action is not allowed"</span>);</div><div class="line">}</div><div class="line">}</div></pre></figure><br><u>N.B</u><br>I used Spring to bind user’s context (which stores user information) to the current Thread via a ThreadLocal to easily retrieve user’s data stored in memory and avoid being tied to the Servlet API. ContextMgr classhas a static method to retrieve user’s context.Actually binding is done with a Spring MVC interceptor on controllers in the Spring Web Application Context(you could also use a Servlet filter):<br><figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"authurlMapping"</span></span></div><div class="line"><span class="attribute">class</span>=<span class="value">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;</div><div class="line">   <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"mappings"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">props</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"/jobs.htm"</span>&gt;</span>JobMultiActionController<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">         <span class="comment">&lt;!-- Add additional URL mappings here --&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="title">props</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"interceptors"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">list</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="title">ref</span> <span class="attribute">bean</span>=<span class="value">"ContextInterceptor"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="title">list</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>The ContextInterceptor bean just retrieves user’s data from the HTTP session<br>and binds it to the current thread</p>
<p><u>2) Declaring the poincuts</u></p>
<p>Then we add pointcuts to execute the aspect. Here the pointcuts are defined with AspectJ expressions</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">aop:config</span> <span class="attribute">proxyTargetClass</span>=<span class="value">"true"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">aop:aspect</span> <span class="attribute">id</span>=<span class="value">"beforeAdviceJobAuth"</span> <span class="attribute">ref</span>=<span class="value">"jobAuthorizationAspect"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">aop:advice</span></span></div><div class="line">kind="before"</div><div class="line">method="checkForAuthorization" <span class="attribute">arg-names</span>=<span class="value">"job"</span></div><div class="line"><span class="attribute">pointcut</span>=<span class="value">"(execution(* jobqueue.JobExecutorService.stopJob(..)) and args (job)) || ( execution(* jobqueue.JobExecutorService.removeJob(..)) and args(job)) "</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="title">aop:aspect</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">aop:config</span>&gt;</span></div></pre></figure>


<p>So here we are weaving our jobAuthorizationAspect advice with the JobExecutorService bean (not detailed here).The proxyTargetClass attribute is here because the JobExecutorService is declared elsewehere in Spring’s applicationContext and injected and used directly in Spring MVC controllers not via its interfaces. But the bean’s class implements multiple interfaces (infrastructure interfaces like Observer )Spring’s default behaviour is when it detects that the class implements interfaces it to use Java dynamic proxies. So here we set this attribute to force CGLib proxying.The arg-names attribute is here to be as explicit as possible and make sure that our “before” advice is executed for the proper methods of JobExecutorService and that the Job argument is passed (by reference) to the “checkForAuthorization” method of our advice.</p>
<p><u>3) Dealing with the AuthorizationException</u></p>
<p>Spring has a mechanism that allows to intercept exceptions and deal with them.We could catch the error and redirects to a page displaying a generic authorization message,we’ll choose to extend this concept to return to the submitting view to display the message.Here’s the declaration of the AuthorizedExceptionResolver</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"AuthorizedExceptionResolver"</span> <span class="attribute">class</span>=<span class="value">"web.AuthorizedExceptionResolver"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"order"</span>&gt;</span><span class="tag">&lt;<span class="title">value</span>&gt;</span>1<span class="tag">&lt;/<span class="title">value</span>&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>And a simplified version of the code (we’ll suppose that all our controllersare SimpleFormController ). :</p>
<p><figure class="highlight java"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecoverableExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span>,<span class="title">Ordered</span>,<span class="title">ApplicationContextAware</span> </span>{</div><div class="line"> </div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> order;</div><div class="line"> </div><div class="line"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span>(HttpServletRequest request,HttpServletResponse response,Object handler,Exception e) {</div><div class="line"> </div><div class="line"><span class="keyword">if</span> (e <span class="keyword">instanceof</span> RecoverableException ) {</div><div class="line"> </div><div class="line">Map&lt;Object,Object&gt; messages = <span class="keyword">new</span> HashMap&lt;Object,Object&gt;();</div><div class="line"><span class="keyword">if</span> (handler != <span class="keyword">null</span> &amp;&amp; handler <span class="keyword">instanceof</span> AbstractController ) {</div><div class="line">   AbstractController controller = (AbstractController)handler;</div><div class="line">   messages.put(<span class="string">"errormessage"</span>,controller.getApplicationContext().getMessage(((AuthorizedException)e).getMessageKey(),<span class="string">"not authorized"</span>,((AuthorizedException)e).getMessage(),request.getLocale()));</div><div class="line">request.setAttribute(<span class="string">"messages"</span>,messages);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">// If SimpleFormController return internally to its view</span></div><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != handler &amp;&amp; handler <span class="keyword">instanceof</span> SimpleFormController) {</div><div class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(controller.getFormView());</div><div class="line">}</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span>() {</div><div class="line"><span class="keyword">return</span> order;</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span>(<span class="keyword">int</span> order) {</div><div class="line"><span class="keyword">this</span>.order = order;</div><div class="line">}</div><div class="line"> </div><div class="line">}</div></pre></figure><br>Here I made the assumption that the command (object that maps the HTTP submitted parameters)has been bound to user’s session in the controller (Spring has mechanism to do this)and that the form’s view first check that if the form’s command is in the user’s sessionit uses it to populate the form’s fields.We’ll also suppose that the controller’s form view has a box that displays messages whenfound in the request context under the messages attribute (like flash boxes of ROR).</p>
<p><u>Conclusion:</u><br>AOP is the perfect tool to protect business components in a non-intrusive way.Thanks to Spring MVC framework techniques we can create a very flexible and genericway to handle authorizations and report authorization exceptions in our web layer. (using many of the Java EE cool buzz technos)</p>
<p><em>N.B:</em> Sorry for my poor English…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/spring-aop-and-mvc-authorization-2/" data-id="otgkxdhw0jd98gye" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/spring-aop-and-mvc-authorization-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aop/">aop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspectj/">aspectj</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-article-on-spring-and-aop-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/article-on-spring-and-aop-2/" class="article-date">
  <time datetime="2005-12-23T23:00:00.000Z" itemprop="datePublished">Dec 24 2005</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/article-on-spring-and-aop-2/">Article on Spring and AOP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>An excellent article on <a href="http://dev2dev.bea.com/pub/a/2005/12/spring-aop-with-ejb.html" target="_blank" rel="external">Spring, AOP, EJBs and testing </a> has been published on dev2dev.bea.com from Eugene Kuleshov. It’s intended for Spring newcomers and intermediate users. I have just read it and highly recommand it.</p>
<p>It deals with:</p>
<ul>
<li>Simplifying usage of EJB (SSB here) by delegating to Spring beans and how to inject Spring beans in EJBs</li>
<li>Weaving application logic in Spring beans without modifying them using AOP</li>
<li>Testing techniques by mocking beans which rely on infrastructure components with Junit and JMock</li>
</ul>
<p>I wasn’t aware of using Spring’s BeanPostProcessor to switch beans at runtime which prevents from writing another applicationContext.xml file for testing.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/article-on-spring-and-aop-2/" data-id="7cutbdajuragktnx" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/article-on-spring-and-aop-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aop/">aop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-persistent-quartz-jobs-with-spring-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/persistent-quartz-jobs-with-spring-2/" class="article-date">
  <time datetime="2005-10-24T22:00:00.000Z" itemprop="datePublished">Oct 25 2005</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/persistent-quartz-jobs-with-spring-2/">Persistent Quartz Jobs with Spring</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I developped a small web Spring MVC application for the company I work for that allowed with other things to schedule executions of Ant scripts (reinventing the wheel…)</p>
<p><a href="http://www.opensymphony.com/quartz/" target="_blank" rel="external">Quartz</a> is the natural choice in the J2EE world to schedule tasks and allows to express the schedule time (or period) using a Unix CRON pattern. And also Quartz can persist schedule jobs to database.</p>
<p>A Quartz job has to implement the <a href="http://www.opensymphony.com/quartz/api/org/quartz/Job.html" target="_blank" rel="external">Job</a> interface and for persistant jobs the <a href="http://www.opensymphony.com/quartz/api/org/quartz/StatefulJob.html" target="_blank" rel="external">StatefulJob</a> interface. The jobs are scheduled using a <a href="http://www.opensymphony.com/quartz/api/org/quartz/Scheduler.html" target="_blank" rel="external">Scheduler </a> implementation. Spring provides a Scheduler factory (org.springframework.scheduling.quartz.SchedulerFactoryBean) and here I’ll show how to declare the declare a persistent scheduler in Spring’s application context that will store jobs to database (and allow all CRUD operations).</p>
<p>Before that Quartz provide DDL scripts that create the necessary tables for many RDBMS, so you need to apply them on your database.</p>
<p>Let’s declare below the Scheduler using Spring’s factory (SchedulerFactoryBean). Note that the properties are set here for MySQL and some optimized versions of the declared classes exist for other RDBMS</p>
<p>Update: the job store class JobStoreTX handles transactions by itself. Sousing it with a Spring transactional proxy like I did was useless and the schedulertarget could have been used directly. Instead use the JobStoreCMT with a Spring JTAtransaction manager and a JTA aware datasource (see below). </p>
<p>Quartz doc says:</p>
<blockquote>

<p>If you need Quartz to work along with other transactions (i.e. within a J2EE application server), then you should use JobStoreCMT - in which case Quartz will let the app server container manage the transactions.</p>
</blockquote>


<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"schedulertarget"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"quartzProperties"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">props</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"org.quartz.jobStore.class"</span>&gt;</span>org.quartz.impl.jdbcjobstore.JobStoreCMT<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"org.quartz.jobStore.driverDelegateClass"</span>&gt;</span>org.quartz.impl.jdbcjobstore.StdJDBCDelegate<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"org.quartz.jobStore.tablePrefix"</span>&gt;</span>QRTZ_<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">props</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"dataSource"</span>&gt;</span><span class="tag">&lt;<span class="title">ref</span> <span class="attribute">bean</span>=<span class="value">"${datasource}"</span>/&gt;</span><span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>Then make methods of the scheduler transactional with a JTA transaction manager.</p>
<figure class="highlight xml"><pre><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"dataSource"</span></span></div><div class="line">   <span class="attribute">class</span>=<span class="value">"org.springframework.jndi.JndiObjectFactoryBean"</span>&gt;</div><div class="line">     <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jndiName"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>java:comp/env/jdbc/myds<span class="tag">&lt;/<span class="title">value</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"transactionManager"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.transaction.jta.JtaTransactionManager"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"dataSource"</span> <span class="attribute">ref</span>=<span class="value">"${datasource}"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"scheduler"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"transactionManager"</span> <span class="attribute">ref</span>=<span class="value">"transactionManager"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"target"</span> <span class="attribute">ref</span>=<span class="value">"schedulertarget"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"transactionAttributes"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="title">props</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"*"</span>&gt;</span>PROPAGATION_REQUIRED<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="title">props</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></figure>

<p>Then you can inject directly the scheduler to a Spring MVC controller and programmatically have it doing CRUD operations on Job schedules (or use a cleaner approach with a DAO),etc.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.dewavrin.info/blog/persistent-quartz-jobs-with-spring-2/" data-id="bxre62dhesg6ck26" class="article-share-link">Share</a>
      
        <a href="http://www.dewavrin.info/blog/persistent-quartz-jobs-with-spring-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/quartz/">quartz</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
<div class="widget-wrap">
   <h3 class="widget-title">tweets</h3>
   <div class="widget">
               <a class="twitter-timeline"  
                   href="https://twitter.com/lucdew" 
                   data-chrome="noheader nofooter noborders transparent"
                   data-tweet-limit="5"
                   data-widget-id="518280804359610368">Tweets by @lucdew</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
   </div>
</div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ant/" style="font-size: 12.00px;">ant</a><a href="/tags/aop/" style="font-size: 12.00px;">aop</a><a href="/tags/aspectj/" style="font-size: 12.00px;">aspectj</a><a href="/tags/asterisk/" style="font-size: 10.00px;">asterisk</a><a href="/tags/axis/" style="font-size: 10.00px;">axis</a><a href="/tags/blog/" style="font-size: 10.00px;">blog</a><a href="/tags/eclipse/" style="font-size: 12.00px;">eclipse</a><a href="/tags/ejb/" style="font-size: 10.00px;">ejb</a><a href="/tags/firewall/" style="font-size: 16.00px;">firewall</a><a href="/tags/freebsd/" style="font-size: 10.00px;">freebsd</a><a href="/tags/grails/" style="font-size: 10.00px;">grails</a><a href="/tags/groovy/" style="font-size: 12.00px;">groovy</a><a href="/tags/gwt/" style="font-size: 10.00px;">gwt</a><a href="/tags/htmlunit/" style="font-size: 10.00px;">htmlunit</a><a href="/tags/jBPM/" style="font-size: 12.00px;">jBPM</a><a href="/tags/java/" style="font-size: 16.00px;">java</a><a href="/tags/jaxb/" style="font-size: 10.00px;">jaxb</a><a href="/tags/jdbc/" style="font-size: 12.00px;">jdbc</a><a href="/tags/jibx/" style="font-size: 10.00px;">jibx</a><a href="/tags/jms/" style="font-size: 10.00px;">jms</a><a href="/tags/jmx/" style="font-size: 10.00px;">jmx</a><a href="/tags/jpa/" style="font-size: 10.00px;">jpa</a><a href="/tags/jrockit/" style="font-size: 10.00px;">jrockit</a><a href="/tags/jsf/" style="font-size: 10.00px;">jsf</a><a href="/tags/jta/" style="font-size: 10.00px;">jta</a><a href="/tags/ldap/" style="font-size: 10.00px;">ldap</a><a href="/tags/lingo/" style="font-size: 10.00px;">lingo</a><a href="/tags/maven/" style="font-size: 18.00px;">maven</a><a href="/tags/misc/" style="font-size: 18.00px;">misc</a><a href="/tags/osgi/" style="font-size: 10.00px;">osgi</a><a href="/tags/quartz/" style="font-size: 10.00px;">quartz</a><a href="/tags/rails/" style="font-size: 10.00px;">rails</a><a href="/tags/ruby/" style="font-size: 10.00px;">ruby</a><a href="/tags/seam/" style="font-size: 14.00px;">seam</a><a href="/tags/security/" style="font-size: 14.00px;">security</a><a href="/tags/snmp/" style="font-size: 10.00px;">snmp</a><a href="/tags/spring/" style="font-size: 20.00px;">spring</a><a href="/tags/subversion/" style="font-size: 10.00px;">subversion</a><a href="/tags/svn/" style="font-size: 10.00px;">svn</a><a href="/tags/swing/" style="font-size: 10.00px;">swing</a>
    </div>
  </div>

  
    <div class="widget-wrap">
   <h3 class="widget-title">Visitors</h3>
   <div class="widget">
         <a href="http://www2.clustrmaps.com/counter/maps.php?url=http://www.dewavrin.info" id="clustrMapsLink"><img src="http://www2.clustrmaps.com/counter/index2.php?url=http://www.dewavrin.info" style="text-decoration: none; margin-bottom: 1em; border:1px solid;" onmouseover="this.style.textDecoration = 'none'" alt="Locations of visitors to this page" title="Locations of visitors to this page" id="clustrMapsImg" onError="this.onError=null; this.src='http://clustrmaps.com/images/clustrmaps-back-soon.jpg'; document.getElementById('clustrMapsLink').href='http://clustrmaps.com'" /> </a>
   </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">April 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">March 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">February 2009</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">October 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/09/">September 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/08/">August 2008</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">June 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/05/">May 2008</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">January 2008</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/12/">December 2007</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/11/">November 2007</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/08/">August 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/07/">July 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/06/">June 2007</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/02/">February 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/01/">January 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/12/">December 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/11/">November 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/06/">June 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/05/">May 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/04/">April 2006</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/02/">February 2006</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2006/01/">January 2006</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/12/">December 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/10/">October 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/09/">September 2005</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/08/">August 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/07/">July 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/06/">June 2005</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/05/">May 2005</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/04/">April 2005</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/03/">March 2005</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2005/02/">February 2005</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/12/">December 2004</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/10/">October 2004</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/09/">September 2004</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/08/">August 2004</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/07/">July 2004</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2004/04/">April 2004</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Luc Dewavrin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'lucdewavrinsblog';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>